<!DOCTYPE html>
<html>
  <head>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>Census</title>
  </head>
  <body>
    <h1>Visualización de la Información</h1>
    <h3>Trabajo Práctico nro. 3</h3>
    <p>Descripción: Esta página muestra estadísticas obtenidas a partir del censo del año 2010 en Argentina.</p>
    <br>
    <script>
    getJSON('http://localhost:3000/people/men_and_women').then(
      function(returnedData) {
        showCensusData(returnedData);
      }
    )

    function getJSON(url) {
      return $.getJSON(url).then(
        function(jsonResponse, msg, fullResponse) {
          return jsonResponse;
        }
      );
    }

    function showCensusData(data) {
      var svg = d3.select("body").append("svg");

      var width = 6000, barHeight = 30;
      var padding = 3;

      var x = d3.scale.linear().range([0, width]);

      svg.attr("width", width).attr("height", barHeight);

      x.domain([0, 1000]);

      svg.selectAll("text")
      .data(data)
      .enter()
      .append("text")
          .attr("x", function(d) { return 10; })
          .attr("y", function(d, i) { return i * barHeight + barHeight / 2; })
          .attr("font-family", "sans-serif")
          .attr("font-weight", "bold")
          .text(function(d) { return d.title; });

      drawRectangle(svg, data, barHeight, padding, x, 0, "#12AD2A");
      drawRectangle(svg, data, barHeight, padding, x, x(data[0].info.percentage), "#FF3E33");
    }

    function drawRectangle(svg, data, barHeight, padding, x, offset, color) {
      var rect = svg.selectAll("rect2")
         .data(data)
         .enter()
         .append("rect")
           .attr("width", function(d) { return x(d.info.percentage); })
           .attr("height", barHeight)
           .attr("x", function (d) { return 100 + offset; } )
           .attr("y", function(d, i) { return barHeight * i; } )
           .attr("fill", color)
           .attr("stroke", "white")
           .attr("stroke-width", padding)
    }
    </script>
  </body>
</html>
